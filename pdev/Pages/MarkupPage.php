<?phpenum(array( // MarkupPageFlags	'MPFLAG_COMMENTS_AVAILABLE'	=> 0x01,));class MarkupPage extends CommentablePage{	var $ready = false;	// MarkupText objects	var $content = NULL;	var $quickfacts = NULL;	var $id;	var $markupFlags;	// Constructor	public function __construct($url)	{		parent::__construct();		$data = DB::World()->SelectRow('				SELECT p.id, p.icon, p.title, p.contents AS content_id, p.quickfacts AS quickfacts_id, p.view_access, p.flags,					c.content AS content_main, c.flags AS content_flags,					q.content AS quickfacts_main, q.flags AS quickfacts_flags				FROM ?_markup2_pages p				LEFT JOIN ?_markup2_texts c ON p.contents > 0 AND p.contents = c.id				LEFT JOIN ?_markup2_texts q ON p.quickfacts > 0 AND p.quickfacts = c.id				WHERE p.url = ?			',			$url		);		if(!$data)			return;		$this->id = $data['id'];		if($data['content_main'])			$this->content = new MarkupText($data['content_id'], $data['content_main'], $data['content_flags']);		if($data['quickfacts_main'])			$this->quickfacts = new MarkupText($data['quickfacts_id'], $data['quickfacts_main'], $data['quickfacts_flags']);		$this->title = $data['title'];		$this->icon = $data['icon'];		$this->markupFlags = $data['flags'];		$this->access = $data['view_access'];		$this->ready = true;	}	function hasFlag($a) { return ($this->markupFlags & $a) != 0; }	function finish()	{		parent::display('markup');	}	public function isCommentable() { return $this->hasFlag(MPFLAG_COMMENTS_AVAILABLE); }	/*public function save()	{		if(!$this->isLoaded())			$this->saveAsNew();		else		{			DB::World()->query('					UPDATE ?_markup					SET						title = ?,						title_icon = ?,						content = ?,						quickfacts = ?,						flags = ?d					WHERE						id = ?d				',				$this->title,				$this->title_icon,				$this->getContent(),				$this->quickfacts,				intval($this->getFlags()),				$this->getId()			);		}	}	public function saveAsNew()	{		global $user;		$newid = DB::World()->query('				INSERT INTO ?_markup (title,title_icon,content,quickfacts,flags,addtime,author)				VALUES (?,?,?,?,?d,UNIX_TIMESTAMP(),?d)			',			$this->title, $this->title_icon, $this->getContent(), $this->quickfacts, intval($this->getFlags()), $user['id']		);		$this->setId($newid);	}	public function saveAsModified()	{		if(!$this->isLoaded())			return;		global $user;		DB::World()->Query('				INSERT INTO ?_markup_history (id,time,modifier,content,quickfacts)				VALUES (?d,UNIX_TIMESTAMP(),?d,?,?)			',			$this->getId(),			$user['id'],			$this->getContent(),			$this->quickfacts		);	}*/}?>