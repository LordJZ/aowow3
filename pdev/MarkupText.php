<?phpenum(array( // MarkupTextFlags	'MTFLAG_PARAGRAPH'	=> 0x01,	'MTFLAG_FORCETEXT'	=> 0x02,));enum(array( // BasicMarkupTexts	'MARKUPTEXT_ONELINER'	=> 1,	'MARKUPTEXT_NEWSTEXT'	=> 2,));class MarkupText{	var $id;	var $contents;	var $hash;	var $flags;	function __construct($id, $text, $flags = 0)	{		$this->contents = $text;		$this->flags = $flags;	}	function parse($group)	{		$this->contents = trim(str_replace("\r", '', $this->contents));		if(!($group & U_GROUP_SEE_ADMIN_TAG))			$this->contents = preg_replace('/(\[admin\](.+?)\[\/admin\])/s', '', $this->contents);		if($group & U_GROUP_LINKS_ALLOWED)		{			if(preg_match_all('/(\[(achievement|item|quest|spell|npc)=(\d+)\])/', $this->contents, $matches))			{				// do stuff			}		}		$this->hash = substr(md5($this->contents), 0, 6);	}	function toHTML()	{		$element = $this->hasFlag(MTFLAG_PARAGRAPH) ? 'p' : 'div';		$html = '<'.$element.' ';		$html .= 'id="markup-'.($this->hash).'"';		if($this->hasFlag(MTFLAG_FORCETEXT))			$html .= ' class="text"';		$html .= '></'.$element.'>';		$html .= '<script type="text/javascript">';		// TODO: rewrite strtr(...)		$html .= 'Markup.printHtml("'.jsEscape($this->contents).'", "markup-'.($this->hash).'"';		if($this->id)			$html .= ', { uid: '.($this->id).' }';		$html .= ')</script>';		return $html;	}	function replace($arr)	{		foreach($arr as $name => $value)			$this->contents = str_replace('%'.$name.'%', $value, $this->contents);	}	function setFlag($to) { $this->flags |= $to; }	function hasFlag($flag) { return ($this->flags & $flag) != 0; }	public static function LoadFromDB($id)	{		$result = DB::World()->SelectRow('SELECT id, content, flags FROM ?_markup2_texts WHERE id = ?d', $id);		if($result)			return new MarkupText($result['id'], $result['content'], $result['flags']);		return NULL;	}}?>